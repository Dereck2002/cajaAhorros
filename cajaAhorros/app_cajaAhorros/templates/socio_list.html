<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Listado de Socios</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ccc;
        }
        th {
            background-color: #f2f2f2;
        }
        img {
            width: 50px;
            height: 50px;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <h1>Listado de Socios</h1>
    <a href="{% url 'crear_socio' %}">‚ûï Nuevo Socio</a>

    <!-- Bot√≥n para gestionar cargos -->
    <button onclick="abrirModalCargo()" style="margin-top: 20px;">‚öôÔ∏è Gestionar Cargos</button>

    <!-- Filtro por estado de aportaci√≥n -->
    <form method="get">
        <label for="filtro">Filtrar por estado de aportaci√≥n:</label>
        <select name="filtro" id="filtro" onchange="this.form.submit()">
            <option value="todos" {% if filtro == 'todos' %}selected{% endif %}>Todos</option>
            <option value="al_dia" {% if filtro == 'al_dia' %}selected{% endif %}>Al d√≠a</option>
            <option value="deudores" {% if filtro == 'deudores' %}selected{% endif %}>Deudores</option>
        </select>
    </form>

    <!-- Buscador -->
    <input type="text" id="buscador" placeholder="Buscar..." onkeyup="filtrarTabla()" style="margin-top: 15px; padding: 5px; width: 200px;">

    <!-- Tabla de socios -->
    <table>
        <thead>
            <tr>
                <th>C√©dula</th>
                <th>Nombres</th>
                <th>Foto</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for socio in socios %}
            <tr>
                <td>{{ socio.cedula }}</td>
                <td>{{ socio.nombre }} {{ socio.apellido }}</td>
                <td>
                    {% if socio.foto %}
                        <img src="{{ socio.foto.url }}" alt="Foto de {{ socio.nombre }}">
                    {% else %}
                        Sin foto
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'detalle_socio' socio.id %}">üîç Ver Detalle</a>
                    <a href="{% url 'ver_aportaciones_socio' socio.id %}">üëÅ Ver</a>
                    <a href="{% url 'editar_socio' socio.id %}">‚úèÔ∏è Editar</a>
                    <a href="#" onclick="abrirModal('{{ socio.id }}', '{{ socio.nombre }} {{ socio.apellido }}', 'socio'); return false;">üóë Eliminar</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4">No hay socios registrados.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Paginaci√≥n -->
    <div style="margin-top: 20px;">
        {% if socios.has_previous %}
            <a href="?page={{ socios.previous_page_number }}&filtro={{ filtro }}">‚¨Ö Anterior</a>
        {% endif %}

        <span>P√°gina {{ socios.number }} de {{ socios.paginator.num_pages }}</span>

        {% if socios.has_next %}
            <a href="?page={{ socios.next_page_number }}&filtro={{ filtro }}">Siguiente ‚û°</a>
        {% endif %}
    </div>

    {% include "includes/modal_confirmacion.html" %}
    {% include "includes/modal_agregar_cargos.html" %}

    <script>
    // Filtro din√°mico para la tabla
    function filtrarTabla() {
        const input = document.getElementById("buscador").value.toLowerCase();
        const filas = document.querySelectorAll("table tbody tr");

        filas.forEach(fila => {
            const textoFila = fila.innerText.toLowerCase();
            fila.style.display = textoFila.includes(input) ? "" : "none";
        });
    }

    // Modal eliminar socio
    function abrirModal(id, nombre, tipo) {
        const modal = document.getElementById('modalEliminar');
        const texto = document.getElementById('modalTexto');
        const form = document.getElementById('formEliminar');

        texto.textContent = `¬øEst√°s seguro de que deseas eliminar a ${nombre}?`;

        if (tipo === 'socio') {
            form.action = `/socios/eliminar/${id}/`;
        } else if (tipo === 'aporte') {
            form.action = `/aportaciones/eliminar/${id}/`;
        }

        modal.style.display = 'flex';
    }

    function cerrarModal() {
        document.getElementById('modalEliminar').style.display = 'none';
    }
    </script>
</body>
</html>
