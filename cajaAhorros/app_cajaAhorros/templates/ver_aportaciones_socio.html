<h2>Resumen de Aportaciones de {{ socio.nombre }} {{ socio.apellido }}</h2>

<!-- Botón para abrir el modal -->
<button onclick="document.getElementById('modalAporte').style.display='block'" style="margin-bottom: 20px;">
    ➕ Agregar Aportación
</button>

<p><strong>Total de aportes:</strong> ${{ total_aportes|floatformat:2 }}</p>
<p><strong>Total de retiros:</strong> ${{ total_retiros|floatformat:2 }}</p>
<p><strong>Saldo actual:</strong> ${{ saldo|floatformat:2 }}</p>

{% if movimientos|length == 0 %}
    <div style="border: 2px solid orange; padding: 10px; margin-bottom: 20px; background-color: #fff3cd;">
        ⚠ Sin aportaciones registradas para este socio.
    </div>
{% elif meses_faltantes %}
    <div style="border: 2px solid red; padding: 10px; margin-bottom: 20px; background-color: #ffe6e6;">
        <strong>⚠ Meses sin aportaciones detectados:</strong>
        <ul>
            {% for mes in meses_faltantes %}
                <li>{{ mes }}</li>
            {% endfor %}
        </ul>
    </div>
{% else %}
    <div style="border: 2px solid green; padding: 10px; margin-bottom: 20px; background-color: #e6ffe6;">
        ✅ No hay meses faltantes de aportaciones.
    </div>
{% endif %}

<table border="1">
    <thead>
        <tr>
            <th>Fecha</th>
            <th>Detalle</th>
            <th>Entrada</th>
            <th>Salida</th>
            <th>Saldo</th>
        </tr>
    </thead>
    <tbody>
        {% for m in movimientos %}
        <tr>
            <td>{{ m.fecha_movimiento }}</td>
            <td>{{ m.detalle_movimiento }}</td>
            <td>${{ m.entrada }}</td>
            <td>${{ m.salida }}</td>
            <td>${{ m.saldo }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<a href="{% url 'socio_list' %}">⬅ Volver al listado</a>

<!-- Modal de Aportación -->
<div id="modalAporte" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color: rgba(0,0,0,0.5); z-index:1000;">
    <div style="background:white; width:400px; margin:100px auto; padding:20px; border-radius:8px; position:relative;">
        <h3>Agregar Aportación</h3>
        <form method="POST" action="{% url 'agregar_aporte' socio.id %}">
            {% csrf_token %}
            <label>Detalle:</label><br>
            <input type="text" name="detalle_movimiento" required><br><br>

            <label>Monto del aporte ($):</label><br>
            <input type="number" step="0.01" name="entrada" required><br><br>

            <label>Fecha:</label><br>
            <input type="date" name="fecha_movimiento" required><br><br>

            <button type="submit">Guardar</button>
            <button type="button" onclick="document.getElementById('modalAporte').style.display='none'">Cancelar</button>
        </form>
    </div>
</div>
