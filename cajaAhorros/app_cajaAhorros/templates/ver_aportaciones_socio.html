    {% extends "base.html" %}

    {% block title %}<h2>Resumen de Aportaciones de {{ socio.nombre }} {{ socio.apellido }}</h2>{% endblock title %}

    {% block content %} 

    <div class="container mt-4">

<button onclick="abrirModalAgregar()" style="margin-bottom: 20px;">‚ûï Agregar Aportaci√≥n</button>

<p><strong>Total de aportes:</strong> ${{ total_aportes|floatformat:2 }}</p>
<p><strong>Total de retiros:</strong> ${{ total_retiros|floatformat:2 }}</p>
<p><strong>Saldo actual:</strong> ${{ saldo|floatformat:2 }}</p>

{% if movimientos|length == 0 %}
    <div style="border: 2px solid orange; padding: 10px; margin-bottom: 20px; background-color: #fff3cd;">
        ‚ö† Sin aportaciones registradas para este socio.
    </div>
{% elif meses_faltantes %}
    <div style="border: 2px solid red; padding: 10px; margin-bottom: 20px; background-color: #ffe6e6;">
        <strong>‚ö† Meses sin aportaciones detectados:</strong>
        <ul>
            {% for mes in meses_faltantes %}
                <li>{{ mes }}</li>
            {% endfor %}
        </ul>
    </div>
{% else %}
    <div style="border: 2px solid green; padding: 10px; margin-bottom: 20px; background-color: #e6ffe6;">
        ‚úÖ No hay meses faltantes de aportaciones.
    </div>
{% endif %}

<table border="1">
    <thead>
        <tr>
            <th>Fecha</th>
            <th>Detalle</th>
            <th>Entrada</th>
            <th>Salida</th>
            <th>Saldo</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for m in movimientos %}
        <tr>
            <td>{{ m.fecha_movimiento }}</td>
            <td>{{ m.detalle_movimiento }}</td>
            <td>${{ m.entrada }}</td>
            <td>${{ m.salida }}</td>
            <td>${{ m.saldo }}</td>
            <td>
                <button onclick="abrirModalEditar({{ m.id }}, '{{ m.detalle_movimiento }}', {{ m.entrada }}, '{{ m.fecha_movimiento }}')">‚úèÔ∏è Editar</button>
                <button onclick="abrirModal('{{ m.id }}', 'la aportaci√≥n de {{ m.fecha_movimiento }}', 'aporte')">üóë Eliminar</button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<a href="{% url 'socio_list' %}">‚¨Ö Volver al listado</a>

<!-- Modal para Agregar/Editar Aportaci√≥n -->
<div id="modalAporte" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color: rgba(0,0,0,0.5); z-index:1000;">
    <div style="background:white; width:400px; margin:100px auto; padding:20px; border-radius:8px; position:relative;">
        <h3 id="modalTitulo">Agregar Aportaci√≥n</h3>
        <form method="POST" id="formAporte" action="{% url 'agregar_aporte' socio.id %}">
            {% csrf_token %}
            <label>Detalle:</label><br>
            <input type="text" name="detalle_movimiento" id="detalle_movimiento" required><br><br>

            <label>Monto del aporte ($):</label><br>
            <input type="number" step="0.01" name="entrada" id="entrada" required><br><br>

            <label>Fecha:</label><br>
            <input type="date" name="fecha_movimiento" id="fecha_movimiento" required><br><br>

            <button type="submit" id="btnGuardar">Guardar</button>
            <button type="button" onclick="cerrarModal()">Cancelar</button>
        </form>
    </div>
</div>
</div>

<!-- Modal de confirmaci√≥n reutilizable -->
    {% include "includes/modal_confirmacion.html" %}
    {% include "includes/modal_agregar_cargos.html" %}
    {% endblock content %}

    {% block java-script-extra %}

<script>
function abrirModalAgregar() {
    document.getElementById('modalTitulo').innerText = 'Agregar Aportaci√≥n';
    document.getElementById('formAporte').action = "{% url 'agregar_aporte' socio.id %}";
    document.getElementById('detalle_movimiento').value = '';
    document.getElementById('entrada').value = '';
    document.getElementById('fecha_movimiento').value = '';
    document.getElementById('modalAporte').style.display = 'block';
}

function abrirModalEditar(id, detalle, entrada, fecha) {
    document.getElementById('modalTitulo').innerText = 'Editar Aportaci√≥n';
    document.getElementById('formAporte').action = '/aportes/editar/' + id + '/';
    document.getElementById('detalle_movimiento').value = detalle;
    document.getElementById('entrada').value = entrada;
    document.getElementById('fecha_movimiento').value = fecha;
    document.getElementById('modalAporte').style.display = 'block';
}

function cerrarModal() {
    document.getElementById('modalAporte').style.display = 'none';
}

function abrirModal(id, nombre, tipo) {
    const modal = document.getElementById('modalEliminar');
    const texto = document.getElementById('modalTexto');
    const form = document.getElementById('formEliminar');

    texto.textContent = `¬øEst√°s seguro de que deseas eliminar ${nombre}?`;

    if (tipo === 'socio') {
        form.action = `/socios/eliminar/${id}/`;
    } else if (tipo === 'aporte') {
        form.action = `/aportes/eliminar/${id}/`;
    }

    modal.style.display = 'flex';
}

function cerrarModalConfirmacion() {
    document.getElementById('modalEliminar').style.display = 'none';
}
</script>
{% endblock java-script-extra %}